<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Masuk Akun</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #4e342e, #a1887f);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Poppins', sans-serif;
      }

      .card {
        border-radius: 16px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
        background: #fffaf5;
        padding: 2rem;
        transition: 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.3);
      }

      .brand-header {
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .brand-header h1 {
        font-size: 1.8rem;
        color: #4e342e;
        font-weight: 700;
        margin-bottom: 0.3rem;
      }

      .brand-header p {
        color: #8d6e63;
        font-size: 0.95rem;
      }

      h4 {
        color: #6f4e37;
        font-weight: 700;
      }

      label {
        color: #5d4037;
        font-weight: 500;
      }

      .form-control {
        border: 1px solid #c7a17a;
        border-radius: 8px;
        padding: 10px;
        transition: 0.2s;
      }

      .form-control:focus {
        border-color: #8b5e3c;
        box-shadow: 0 0 0 0.2rem rgba(139, 94, 60, 0.25);
      }

      .btn-custom {
        background: #8b5e3c;
        border: none;
        border-radius: 8px;
        padding: 0.7rem;
        font-weight: 600;
        color: #fffaf0;
        transition: 0.3s;
      }

      .btn-custom:hover {
        background: #6f4e37;
        transform: translateY(-2px);
      }

      .footer-text {
        margin-top: 1rem;
        color: #4e342e;
      }

      .footer-text a {
        color: #8b5e3c;
        font-weight: 600;
        text-decoration: none;
      }

      .footer-text a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="card col-md-6 col-lg-4">
      <div class="brand-header">
        <h1>Restoran Nusantara</h1>
        <p>Sajian cita rasa autentik Indonesia</p>
      </div>

      <h4 class="text-center mb-4">Masuk ke Akun Anda</h4>

      <form id="loginForm">
        <div class="mb-3">
          <label>Email</label>
          <input type="email" id="email" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Kata Sandi</label>
          <input type="password" id="password" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-custom w-100">Masuk Sekarang</button>
      </form>

      <p class="footer-text text-center">
        Belum punya akun? <a href="register.html">Daftar di sini</a>
      </p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const emailInput = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value;
          const email = emailInput.toLowerCase();

          try {
            const usersRef = db.ref("users");
            const snapshot = await usersRef
              .orderByChild("email")
              .equalTo(email)
              .once("value");

            if (!snapshot.exists()) {
              alert("Akun belum terdaftar. Silakan daftar terlebih dahulu.");
              return;
            }

            const userCredential = await auth.signInWithEmailAndPassword(
              email,
              password
            );
            const user = userCredential.user;

            if (!user.emailVerified) {
              await auth.signOut();
              alert(
                "Akun belum terverifikasi. Silakan cek email Anda (inbox/spam)."
              );
              return;
            }

            const usersObj = snapshot.val();
            const firstUid = Object.keys(usersObj)[0];
            const profile = usersObj[firstUid] || {};

            alert(
              `Login berhasil! Selamat datang, ${profile.nama || user.email}!`
            );
            window.location.href = "index.html";
          } catch (error) {
            let error_message = "";
            let parsed = null;
            try {
              parsed = JSON.parse(error.message);
            } catch (e) {
              parsed = null;
            }

            if (
              parsed &&
              parsed.error &&
              parsed.error.message === "INVALID_LOGIN_CREDENTIALS"
            ) {
              error_message = "Kata sandi salah. Silakan coba lagi.";
            } else if (parsed && parsed.error && parsed.error.message) {
              error_message = "Terjadi kesalahan: " + parsed.error.message;
            } else {
              error_message =
                "Terjadi kesalahan: " + (error.message || "Unknown error");
            }
            alert(error_message);
          }
        });
    </script>
  </body>
</html>
